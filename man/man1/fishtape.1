.\" generated with Ronn/v0.7.3
.\" http://github.com/rtomayko/ronn/tree/0.7.3
.
.TH "FISHTAPE" "1" "December 2015" "" "fishtape"
.
.SH "NAME"
\fBfishtape\fR \- TAP producer and test harness for fish
.
.SH "SYNOPSIS"
\fBfishtape\fR [\fIfile\fR \.\.\.]
.
.br
\fBfishtape\fR [\fB\-\-time\fR=\fIutility\fR[,\.\.\.]] [\fB\-\-pipe\fR=\fIutility\fR]
.
.br
\fBfishtape\fR [\fB\-\-help\fR] [\fB\-\-version\fR]
.
.br
.
.SH "DESCRIPTION"
\fIFishtape\fR is a TAP (Test Anything Protocol) producer and test harness for fish\. Fishtape reads the specified files, or the standard input if no files are given, and executes \fItest blocks\fR producing a TAP stream\.
.
.P
This utility also provides a simple mechanism for creating microbenchmarks to measure average utility execution speed\.
.
.SH "OPTIONS"
.
.TP
\fB\-t\fR, \fB\-\-time\fR=\fIutility\fR[,\.\.\.]
Benchmark given \fIutility\fR and/or functions\.
.
.TP
\fB\-p\fR, \fB\-\-pipe\fR=\fIutility\fR
Pipe line buffered output into given \fIutility\fR\.
.
.TP
\fB\-v\fR, \fB\-\-version\fR
Show version information\.
.
.TP
\fB\-h\fR, \fB\-\-help\fR
Show help information\.
.
.SH "EXAMPLES"
Test files are fish files with one or more test blocks\. A test block consists of an optional description and any test expression supported by \fBtest\fR(1)\.
.
.IP "" 4
.
.nf

test "current directory is home"
  $HOME = $DIRNAME
end

test "math still works"
  42 \-eq (math 41 + 1)
end

test "test is a builtin"
  "test" = (builtin \-n)
end

test "no odds are evens"
  1 3 5 7 != (
    for i in (seq $n)
      if test (math $i%2) = 0
        echo $i
      end
    end)
end
.
.fi
.
.IP "" 0
.
.P
The general syntax is:
.
.IP "" 4
.
.nf

test description
  <expression>
end
.
.fi
.
.IP "" 0
.
.P
Where \fIexpression\fR is any \fBtest\fR(1) valid expression; in addition, \fB=\fR and \fB!=\fR operators are overloaded to check for item inclusion or exclusion in lists\.
.
.IP "" 4
.
.nf

test "this sentence contains the word it"
  it = this sentence contains the word it
end
.
.fi
.
.IP "" 0
.
.SH "SETUP AND TEARDOWN"
.
.TP
\fBsetup\fR
Run before each test in the current file\. Use \fBsetup\fR to load fixtures and/or set up your environment\.
.
.IP "" 4
.
.nf

set \-l path $DIRNAME/$TESTNAME

function setup
  mkdir \-p $path
end
.
.fi
.
.IP "" 0

.
.TP
\fBteardown\fR
Run after each test in the current file\. Use \fBteardown\fR to clean up loaded resources, etc\.
.
.IP "" 4
.
.nf

function \-S teardown
  rm \-rf $path
end
.
.fi
.
.IP "" 0

.
.SH "VARIABLES"
The following variables are available inside a test file:
.
.TP
\fB$FILENAME\fR
Path to the running script\.
.
.TP
\fB$DIRNAME\fR
Directory name of the running script\.
.
.TP
\fB$TEST\fR
Name of the running script\.
.
.TP
\fB$TAP_VERSION\fR
TAP protocol version\.
.
.SH "METHODS"
The following methods are available inside a test file:
.
.TP
\fBcomment\fR [\fImessage\fR]
Print a message without breaking the tap output\. This is a wrapper for \fBprintf "# %s\en" >&2\fR\.
.
.TP
\fBpass\fR [\fImessage\fR]
Generate a passing assertion with a message\.
.
.TP
\fBfail\fR [\fImessage\fR]
Generate a failing assertion with a message\.
.
.SH "MICROBENCHMARKS"
You can measure average execution speed between functions and/or other utilities using \fB\-\-time\fR=\fIfunction\fR[,\.\.\.]\.
.
.P
This can be useful when trying to compare two or more ways to do the same thing, and we want to know which one is possibly faster\.
.
.IP "" 4
.
.nf

fishtape \-\-time=func{1,2,3} [\-\-pipe=program]
.
.fi
.
.IP "" 0
.
.P
Fishtape will use any available standard input for arguments when invoking each of the given functions:
.
.IP "" 4
.
.nf

fishtape \-\-time=bubble,heap,qsort < numbers
.
.fi
.
.IP "" 0
.
.SH "BUGS"
.
.SS "Line Buffered Output"
According to <github\.com/fish\-shell/fish\-shell/issues/1396> redirections and pipes involving blocks are run serially, not in parallel\. This causes \fBfishtape\fR to block the pipeline and buffer all of its output\. To emit a line buffered stream use \fB\-\-pipe\fR=\fIprogram\fR\.
.
.IP "" 4
.
.nf

fishtape test\.fish \-\-pipe=tap\-consumer
.
.fi
.
.IP "" 0
.
.SS "Tests"
.
.IP "\(bu" 4
Only one expression per test block is allowed\. Use command substitutions to create more complex test expressions\.
.
.IP "\(bu" 4
Each test file is wrapped in \fBbegin; end\fR blocks behind the scenes to protect your local scope\. Also, after each test, global variables are restored to their initial value at the time of running \fBfishtape\fR\.
.
.IP "" 0
.
.SH "AUTHORS"
Jorge Bucaran \fIj@bucaran\.me\fR\. See also AUTHORS\.
.
.SH "SEE ALSO"
.
.IP "\(bu" 4
\fBtest\fR(1)
.
.IP "\(bu" 4
\fBfishtape\fR(7)
.
.IP "\(bu" 4
\fBhelp\fR expand\-command\-substitution
.
.IP "\(bu" 4
\fBhttps://github\.com/fisherman/fishtape/issues\fR
.
.IP "" 0

